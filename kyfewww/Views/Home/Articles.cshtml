@{
	ViewBag.Title = "KYFE Articles";
}

@section scripts {
	<script type="text/javascript">
		$(document).ready(function () {
			var apiUrl = "/api/edit";
			
			function addArticleRow(item) {
				$("#articles tbody").append("<tr><td>" + item.RowKey + "</td><td>" + item.Name + "</td><td>" + item.Author + "</td></tr>");
			}

			function updateArticleRow(item) {
				
			}
			
			function articleGetList(page) {
				$.getJSON(apiUrl).done(function (data) {
					$.each(data, function (key, item) {
						addArticleRow(item);
					});
				});
			}
			
			function articleGet(id) {
				$.getJSON(apiUrl+'/'+id).done(function (data) {
					
				});
			}
			
			function articleCreate(data) {
				$.ajax({
					url: apiUrl,
					type: "POST",
					dataType: "json",
					data: data,
					error: function (jqXHR, textStatus, errorThrown) { },
					success: function (data, textStatus, jqXHR) {
						addArticleRow(data);
					}
				});
			}
			
			function articleUpdate(data) {
				$.ajax({
					url: apiUrl,
					type: "PUT",
					dataType: "json",
					data: data,
					error: function (jqXHR, textStatus, errorThrown) { },
					success: function (data, textStatus, jqXHR) {
						updateArticleRow(data);
					}
				});
			}

			function articleDelete(id) {
				$.ajax({
					url: apiUrl,
					type: "DELETE",
					dataType: "json",
					data: id,
					error: function (jqXHR, textStatus, errorThrown) { },
					success: function (data, textStatus, jqXHR) {
						if (data) {
							
						}
						else {
							
						}
					}
				});
			}
			
			$("#btnSave").click(function() {
				var aType = $('#editType .active').val();
				var aName = $('#editName').val();
				var aLanguage = $('#editLanguage .active').val();
				var aAuthor = $('#editAuthor').val();
				var aText = $('#editText').val();
				if ($.trim(aName).length == 0) {
					$('#editName').addClass("error");
				}
				if (!aType) {
					$("#editType :button").addClass("btn-danger");
					return;
				}
				if (!aLanguage) {
					$("#editLanguage :button").addClass("btn-danger");
					return;
				}

				articleCreate({ "Name": aName, "Locale": aLanguage, "Text": aText, "Author": aAuthor, "PartitionKey": aType });
			});

			$("#editLanguage :button, #editType :button").click(function () {
				$("#editLanguage :button").removeClass("btn-danger");
			});
			$("#editType :button").click(function () {
				$("#editType :button").removeClass("btn-danger");
			});

			articleGetList(0);
			
			$('#editForm').modal({ keyboard: false, hide: true });
			$("#editForm").hide();
		});
	</script>
}

<div id="body">
	<section class="featured">
		<div class="content-wrapper">
			<h2>Articles</h2>
			<button class="btn" data-toggle="modal" data-target="#editForm">Add New</button>
			<table id="articles" class="table table-striped table-hover">
				<thead>
					<tr>
						<th>Date</th>
						<th>Title</th>
						<th>Author</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
	</section>
</div>

<!-- Edit Form -->
<div class="modal hide fade" id="editForm">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		<h3>New article</h3>
	</div>
	<div class="modal-body">
		<p>
				<label for="editName">Title</label>
				<input type="text" class="input-xlarge" id="editName" name="Name" />
			<br />
			<label for="editType">Type</label>
			<div class="btn-group" data-toggle="buttons-radio" id="editType">
				<button type="button" class="btn" name="Type" value="Article">Article</button>
				<button type="button" class="btn" name="Type" value="Meditation">Meditation</button>
				<button type="button" class="btn" name="Type" value="Kriya">Kriya</button>
			</div>
			<br />
			<label for="editLanguage">Language</label>
			<div class="btn-group" data-toggle="buttons-radio" id="editLanguage">
				<button type="button" class="btn" name="Language" value="1">Ru</button>
				<button type="button" class="btn" name="Language" value="2">En</button>
				<button type="button" class="btn" name="Language" value="3">Es</button>
			</div>

			<br />
			<label for="editAuthor">Author</label>
			<input type="text" class="input-xlarge" id="editAuthor" name="Author" />
			<br />
			<label for="editText">Text</label>
			<textarea id="editText" name="Text" rows="5"></textarea>
		</p>
	</div>
	<div class="modal-footer">
		<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
		<button class="btn btn-primary" id="btnSave">Save changes</button>
	</div>
</div>
<!-- [Edit Form] -->

<!-- 
	TODO:
	1. Сделать метку черновика для материала.
-->